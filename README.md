**Тестовое задание:**

Зарегистрировать аккаунт в https://www.amocrm.ru/ Зайти в раздел амоМаркет (/amo-market/).

Нажать на 3 точки в правом верхнем углу - создать "Внешнюю интеграцию" для доступа к amoCRM по API. Документация по созданию интеграций, методам API и получению ключей oAuth - https://www.amocrm.ru/developers/

В разделе амоМаркет в правом верхнем нажать кнопку "+ WEB HOOKS". Выбрать отправку хуков для событий "Сделка добавлена", "Контакт добавлен", "Сделка изменена", "Контакт изменен". В URL прописать адрес скрипта, который необходимо разработать.
Скрипт должен выполнять следующее: добавлять текстовое примечание в карточке, по которой был получен хук. Если получен хук на создание карточки, то текстовое примечание должно содержать название сделки/контакта, ответственного и время добавления карточки. Если получен хук на изменение карточки, то текстовое примечание должно содержать названия и новые значения измененных полей, время изменения карточки.

--------------------------------

**Как запускать:**

**1 шаг** - 
```
docker compose up --build
```

**2 шаг** - перейти в контейнер с апи 
```
docker exec -it test_api /bin/bash
```
и выполнить команду 
```
composer install
```

**3 шаг** - скачать ngrok, если он еще не скачан

```
snap install ngrok
```

**4 шаг** - получить токен на сайте ngrok (если не получится, отправила с hr токен)

```
ngrok authtoken <ваш токен>
```

**5 шаг** - в отдельном окне терминала прописать

```
ngrok http http://localhost:8000
```

и скопировать значение из Forwarding до -> (примерно так будет: 
```
Forwarding https://09fc-46-61-39-169.ngrok-free.app -> http://localhost:8000
```
нужно скопировать https://09fc-46-61-39-169.ngrok-free.app (ссылка будет для вас уникальна))

**6 шаг** - перейти на сайт amoCRM https://tomyatom999.amocrm.ru/amo-market/ , в правом верхнем углу нажать на кнопку +Web Hooks,в открывшемся окне заменить ссылку на ту, что была скопирована в шаге 5

**7 шаг** - в контейнере с апи со второго шага прописать

```
php bin/console messenger:consume async -vv
```

Теперь можно создавать и изменять сделки и контакты и к ним будут добавлены примечания к карточкам.

----------------

**Особенности реализации**

- Так как в amoCRM может прийти два и более хука на одно событие и в них мало полезной информации, обработка хуков идет не по схеме "получен хук - обработан". Если нечего обрабатывать, то примечаний в карточку заноситься не будет. 

- В целях упрощения задания не обрабатывается изменение Компании и Кастомных полей сделки. Обрабатываются Название сделки, Бюджет сделки, Ответственный менеджер сделки, Статус сделки, добавление и открепление контактов от сделки, Имя контакта, Кастомные поля контакта.
